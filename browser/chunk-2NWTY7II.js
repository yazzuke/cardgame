import{a as q,b as f,c as H,d as Q,e as W,f as M,g as S}from"./chunk-KTVTVXL3.js";import{a as N}from"./chunk-NYHKZ5SU.js";import{a as X}from"./chunk-WBUB4ND5.js";import{a as w}from"./chunk-MFZETDTK.js";import{D as g,h as $,k as z,l as U,m as K,n as L,o as J,p as Y}from"./chunk-AMT74OIL.js";import{g as B}from"./chunk-AMAF2MAF.js";import"./chunk-RGNDWIHZ.js";import{A as y,Db as C,Fb as h,Pb as d,Qa as A,Qb as v,Rb as k,Vb as p,Yb as E,Za as m,Zb as R,_a as c,d as _,ha as l,hb as O,jb as x,ma as D,na as I,ob as T,pb as G,rb as V,sb as F,tb as o,ub as a,vb as b,zb as j}from"./chunk-5TXZLY6E.js";var Z=i=>{let t=i.length,s;for(;t>0;)s=Math.floor(Math.random()*t),t--,[i[t],i[s]]=[i[s],i[t]];return i};function ne(i,t){if(i&1&&(o(0,"section",1),b(1,"img",2),o(2,"p",3),d(3),a()()),i&2){let s=h();m(),x("src",s.card.image,A)("alt",s.card.key),m(2),v(s.card.text)}}function re(i,t){i&1&&b(0,"section",4)}var te=(()=>{let t=class t{};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l({type:t,selectors:[["app-card"]],inputs:{card:"card",cardPosition:"cardPosition"},standalone:!0,features:[p],decls:2,vars:1,consts:[["class","card"],[1,"card"],[1,"card__img",3,"src","alt"],["align","center",1,"card__text"],[1,"card__skeleton"]],template:function(e,r){e&1&&O(0,ne,4,3,"section",0)(1,re,1,0),e&2&&T(0,r.cardPosition?0:1)},dependencies:[g],styles:['.card[_ngcontent-%COMP%], .card__skeleton[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:#0003 0 20px 30px;width:320px;height:400px;padding:.5rem;border-radius:40px}.card__skeleton[_ngcontent-%COMP%]{background:url("./media/card-MF7NLPY7.jpg");background-position:top;background-size:contain}.card[_ngcontent-%COMP%]   .card__img[_ngcontent-%COMP%]{width:250px;height:200px;object-fit:cover}.card[_ngcontent-%COMP%]   .card__text[_ngcontent-%COMP%]{font-size:.7rem;width:100%}']});let i=t;return i})();var ie=(()=>{let t=class t{constructor(n,e,r,u,P){this.data=n,this.dialogRef=e,this.router=r,this.coreServer=u,this._snackbar=P}createUserScore(){return _(this,null,function*(){let n={userId:f(Q),username:f(W),wrongChoices:this.data.wrongAnswers,goodChoices:this.data.correctAnswers,timestamp:Date.now(),resolutionTime:90-this.data.timer},e=yield this.coreServer.createUserScore(n);e.status>=200&&e.status<=299?this._snackbar.showNotification("snackbar-success","Registro exitoso.... \u{1F60E}","bottom","center",2e3):this._snackbar.showNotification("snackbar-danger","Registro fallido intenta otra vez.... \u{1F613}","bottom","center",2e3)})}closeDialog(){this.createUserScore(),this.navigateToScoreBoard(),this.dialogRef.close(),H()}navigateToScoreBoard(){this.router.navigate([N.SCOREBOARD])}};t.\u0275fac=function(e){return new(e||t)(c(U),c(z),c(B),c(w),c(S))},t.\u0275cmp=l({type:t,selectors:[["app-game-finish-dialog"]],standalone:!0,features:[p],decls:10,vars:0,consts:[["mat-dialog-title","","align","center"],["mat-dialog-content","","align","center"],["mat-dialog-actions","","align","center"],["mat-button","",3,"click"]],template:function(e,r){e&1&&(o(0,"section",0)(1,"h1")(2,"b"),d(3,"Juego terminado"),a()()(),o(4,"section",1)(5,"p"),d(6,"Gracias por jugar da click en cerrar y continuar \u{1F973}"),a()(),o(7,"section",2)(8,"button",3),C("click",function(){return r.closeDialog()}),d(9,"Cerrar y continuar"),a()())},dependencies:[g,$,L,Y,J]});let i=t;return i})();function ce(i,t){if(i&1){let s=j();o(0,"app-card",5),C("click",function(){let e=D(s),r=e.$implicit,u=e.$index,P=h();return I(P.selectedCard(r,u))}),a()}if(i&2){let s=t.$implicit,n=t.$index,e=h();x("card",s)("cardPosition",e.cardsPosition[n])}}var Ie=(()=>{let t=class t{constructor(n,e,r){this.coreServer=n,this.dialog=e,this._snackbar=r,this.cardsGame=[],this.cardsPosition=[],this.cardPositionIdxTrack=[],this.cardValidation=[],this.timer=90,this.correctAnswers=0,this.wrongAnswers=0}initCards(){return _(this,null,function*(){let n=f(M);if(n!==null)this.cardsGame=n,this.cardsPosition=Array.from({length:this.cardsGame.length}).map((e,r)=>this.cardsGame[r].selected);else{let e=yield this.coreServer.getCards();this.cardsGame=Z(e.body),this.cardsPosition=Array.from({length:this.cardsGame.length}).map(r=>!1),q(M,this.cardsGame)}})}selectedCard(n,e){(this.cardValidation.length===0||this.cardValidation.length===1)&&(this.cardValidation.push(n),this.cardsPosition.splice(e,1,!0),this.cardPositionIdxTrack.push(e),this.validateCards())}validateCards(){this.cardValidation.length===2&&(this.cardValidation[0].key===this.cardValidation[1].key&&(this.cardsGame.map(e=>e.key===this.cardValidation[0].key),this.resetArrays(),this._snackbar.showNotification("snackbar-success","Respuesta correcta! \u{1F389}","bottom","center",2e3),this.correctAnswers++,this.cardsPosition.includes(!1)||this.openGameFinishDialog()),this.cardValidation[0].key!==this.cardValidation[1].key&&(this._snackbar.showNotification("snackbar-danger","Seleccion incorrecta.... \u{1F613}","bottom","center",2e3),this.wrongAnswers++,setTimeout(()=>{this.cardsPosition.splice(this.cardPositionIdxTrack[0],1,!1),this.cardsPosition.splice(this.cardPositionIdxTrack[1],1,!1),this.resetArrays()},2e3)))}resetArrays(){this.cardValidation=[],this.cardPositionIdxTrack=[]}gameTimer(){let e=y(1e3,1e3).subscribe(r=>{this.timer>0?this.timer--:(this.openGameFinishDialog(),e.unsubscribe())})}openGameFinishDialog(){this.dialog.open(ie,{disableClose:!0,data:{timer:this.timer,correctAnswers:this.correctAnswers,wrongAnswers:this.wrongAnswers}})}ngOnInit(){this.initCards(),this.gameTimer()}};t.\u0275fac=function(e){return new(e||t)(c(w),c(K),c(S))},t.\u0275cmp=l({type:t,selectors:[["app-game"]],standalone:!0,features:[p],decls:11,vars:5,consts:[[1,"game"],[1,"game__info"],[1,"info__timer"],[1,"info__correct"],[1,"info__wrong"],[3,"card","cardPosition","click"],[3,"card","cardPosition"]],template:function(e,r){e&1&&(o(0,"section",0)(1,"div",1)(2,"span",2),d(3),E(4,"countdown"),a(),o(5,"span",3),d(6),a(),o(7,"span",4),d(8),a()(),V(9,ce,1,2,"app-card",6,G),a()),e&2&&(m(3),v(R(4,3,r.timer)),m(3),k("Correctas ",r.correctAnswers,""),m(2),k("Erroneas ",r.wrongAnswers,""),m(),F(r.cardsGame))},dependencies:[g,te,X],styles:[".game[_ngcontent-%COMP%]{position:relative;padding:2rem 5%;display:grid;place-content:center;width:100%;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(2,1fr);gap:1rem}.game[_ngcontent-%COMP%]   .game__info[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;right:20px;top:20px;font-weight:900}.game[_ngcontent-%COMP%]   .game__info[_ngcontent-%COMP%]   .info__timer[_ngcontent-%COMP%]{box-shadow:#00000012 0 1px 2px,#00000012 0 2px 4px,#00000012 0 4px 8px,#00000012 0 8px 16px,#00000012 0 16px 32px,#00000012 0 32px 64px;background-color:#8400ff;padding:.5rem 1rem;border-radius:20px;color:#fff}.game[_ngcontent-%COMP%]   .game__info[_ngcontent-%COMP%]   .info__correct[_ngcontent-%COMP%], .game[_ngcontent-%COMP%]   .game__info[_ngcontent-%COMP%]   .info__wrong[_ngcontent-%COMP%]{align-items:center}.game[_ngcontent-%COMP%]   app-card[_ngcontent-%COMP%]{display:block;margin:0 auto;cursor:pointer}"]});let i=t;return i})();export{Ie as GameComponent};
